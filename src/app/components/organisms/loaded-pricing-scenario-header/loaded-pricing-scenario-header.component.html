<div  class="bg-marsgray-100 px-12">
    <div class="flex flex-row items-center justify-between border-b border-gray-300 py-2">
        <div class="flex flex-row flex-wrap content-start items-center justify-start">
            <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="retailers"
                    [hideClose]="true"
                    (click)="sendMessage('filter-retailer')"
                    >
                    <span *ngIf="count_ret.retailers.length > 0"> ({{count_ret.retailers.length}})</span> Retailers
                    </nwn-filter-item
                >
            </div>
            <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="categories"
                    [hideClose]="true"
                    (click)="sendMessage('filter-categories')"
                    >
                    <span *ngIf="count_ret.category.length > 0"> ({{count_ret.category.length}})</span>
                    Categories</nwn-filter-item
                >
            </div>
            <!-- <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="strategic-cells"
                    [hideClose]="true"
                    (click)="sendMessage('filter-stragetic-cells')"
                    >
                    <span *ngIf="count_ret.strategic_cell.length > 0"> ({{count_ret.strategic_cell.length}})</span>
                    Strategic cells</nwn-filter-item
                >
            </div> -->
            <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="brands"
                    [hideClose]="true"
                    (click)="sendMessage('filter-brands')"
                    >
                    <span *ngIf="count_ret.brand.length > 0"> ({{count_ret.brand.length}})</span>

                    Brands</nwn-filter-item
                >
            </div>
            <!-- <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="brand-formats"
                    [hideClose]="true"
                    (click)="sendMessage('filter-brand-formats')"
                    >
                    <span *ngIf="count_ret.brand_format.length > 0"> ({{count_ret.brand_format.length}})</span>
                    Brand formats</nwn-filter-item
                >
            </div> -->
            <div class="mr-2 mb-2">
                <nwn-filter-item
                    type="stroke"
                    nwnSvgIcon="product-groups"
                    [hideClose]="true"
                    (click)="sendMessage('addnew-pricngtool')"
                    >

                    <span *ngIf="count_ret.products.length > 0"> ({{count_ret.products.length}})</span>
                    Product Groups</nwn-filter-item
                >
                <!-- (click)="sendMessage('filter-product-groups')" -->
            </div>
        </div>
        <div>

            <nwn-loaded-scenarioitem *ngIf="!chosen_promotion" title="Untitled" subtitle="Pricing"></nwn-loaded-scenarioitem>
            <nwn-loaded-scenarioitem  (openInfoEvent)="openInfoEvent($event)" *ngIf="chosen_promotion" [title]="chosen_promotion.name" subtitle="Pricing Scenario"></nwn-loaded-scenarioitem>
        </div>
    </div>

<ng-container>
    <!-- [hidden] -->

    <!-- *ngIf="displayProduct.length > 0" -->
    <div
    [ngClass]="{
        hide: isExpand == false,
        show: isExpand == true

    }"
    style="max-height: 425px;overflow-y: auto;margin-left: -40px;margin-right: -40px;" id="close-expand-header"   class="flex flex-col translate-x-1" >
    <div style="display:flex;align-items: flex-start;justify-content: center;gap:10px;padding: 10px;margin: 10px;" (click)="$event.stopPropagation()">
        <div>Percent</div> <nwn-toggle-switch  [(ngModel)]="abs" [showText]="false"   ></nwn-toggle-switch> <div>Absolute</div>
     </div>

        <mat-accordion  class="example-headers-align" multi>
            <form [formGroup]="pricingForm">
            <mat-expansion-panel  *ngFor="let product of displayProduct"  [expanded]="true">
              <mat-expansion-panel-header>
                <mat-panel-title>


                    <ul class="tabs group">
                        <li class="active">
                            <a> {{product}}  </a>


                      </ul>


                </mat-panel-title>



              </mat-expansion-panel-header>


                <table class="w-full border border-marsgray-200 text-left">
                    <thead class="bg-white">
                        <tr class="whitespace-nowrap">
                            <th class="bg-gray-100"  colspan="1" scope="colgroup">
                                <nwn-cell-header type="subheaderlg" color="bggray-100">
                                     Product Group
                                </nwn-cell-header>
                            </th>
                            <th class="bg-gray-100"  colspan="1" scope="colgroup">
                                <nwn-cell-header type="subheaderpds" color="bggray-100">
                                    <div class="flex flex-row justify-between">
                                        <div>COGS</div>
                                        <nwn-checkbox [value] = "'Cogs'" [showTooltip]="true"  (valueChange) = "applyallOpen($event,product)"  [spacex] = "'space-x-1'"  style="align-self: center;" [showLabel]="true">
                                            <span class="applyall"></span>
                                            <p tooltipContent>Apply to all</p>
                                        </nwn-checkbox>
                                    </div>
                                </nwn-cell-header>
                            </th>
<!--                            <th class="bg-gray-100"  colspan="1" scope="colgroup">-->
<!--                                <nwn-cell-header type="subheaderpds" color="bggray-100">-->
<!--                                    <div class="flex flex-row justify-between">-->
<!--                                        <div>List Price</div>-->

<!--                                    </div>-->
<!--                                </nwn-cell-header>-->
<!--                            </th>-->

                            <th class="bg-gray-100"  colspan="1" scope="colgroup">
                                <nwn-cell-header type="subheaderpds" color="bggray-100">
                                    <div class="flex flex-row justify-between">
                                        <div>Shelf Price </div>
                                        <nwn-checkbox (valueChange) = "applyallOpen($event,product)" [value] = "'Shelf Price'"  [showTooltip]="true" [spacex] = "'space-x-1'"  style="align-self: center;" [showLabel]="true">
                                            <span class="applyall"></span>
                                            <p tooltipContent>Apply to all</p>
                                        </nwn-checkbox>

                                    </div>
                                </nwn-cell-header>
                            </th>
<!--                            <th class="bg-gray-100"  colspan="1" scope="colgroup">-->
<!--                                <nwn-cell-header type="subheaderpds" color="bggray-100">-->
<!--                                    <div class="flex flex-row justify-between">-->
<!--                                        <div>% Units in Promo  </div>-->


<!--                                    </div>-->
<!--                                </nwn-cell-header>-->
<!--                            </th>-->
<!--                            <th class="bg-gray-100"  colspan="1" scope="colgroup">-->
<!--                                <nwn-cell-header type="subheaderpds" color="bggray-100">-->
<!--                                    <div class="flex flex-row justify-between">-->
<!--                                        <div>NSV/Unit-Promo </div>-->


<!--                                    </div>-->
<!--                                </nwn-cell-header>-->
<!--                            </th>-->
                            <th class="bg-gray-100"  colspan="1" scope="colgroup">
                                <nwn-cell-header type="subheaderpds" color="bggray-100">
                                    <div class="flex flex-row justify-between">
                                        <div>NSV/Kg </div>
                                        <nwn-checkbox (valueChange) = "applyallOpen($event,product)" [value] = "'NSV/Kg'"  [showTooltip]="true" [spacex] = "'space-x-1'"  style="align-self: center;" [showLabel]="true">
                                            <span class="applyall"></span>
                                            <p tooltipContent>Apply to all</p>
                                        </nwn-checkbox>
                                    </div>
                                </nwn-cell-header>
                            </th>

                            <th class="bg-gray-100"  colspan="1" scope="colgroup">
                                <nwn-cell-header type="subheaderpds" color="bggray-100">
                                    <div class="flex flex-row justify-between">
                                        <div>Elasticity</div>

                                    </div>
                                </nwn-cell-header>
                            </th>

                            <th colspan="3" scope="colgroup" color="bggray-100" >
                                <nwn-cell-header type="subheaderpds" color="bggray-100">
                                    <div class="flex flex-row justify-between">
                                        <div>Competition Follows</div>
                                        <nwn-checkbox (valueChange) = "applyallOpen($event,product)" [value] = "'Internal'"  [showTooltip]="true" [spacex] = "'space-x-1'"  style="align-self: center;" [showLabel]="true">
                                            <span class="applyall">Internal</span>
                                            <p tooltipContent>Apply to all</p>
                                        </nwn-checkbox>
                                        <nwn-checkbox (valueChange) = "applyallOpen($event,product)"  [value] = "'External'"  [showTooltip]="true" [spacex] = "'space-x-1'"  style="align-self: center;" [showLabel]="true">
                                            <span class="applyall">External</span>
                                            <p tooltipContent>Apply to all</p>
                                        </nwn-checkbox>

                                    </div>
                                </nwn-cell-header>

                            </th>
                        </tr>
                        <tr>
                             <td scope="colgroup" colspan="9"></td>
                            <!-- <td scope="colgroup">Internal</td>
                            <td scope="colgroup">Pvt Label</td>
                            <td scope="colgroup">Others</td> -->
                          </tr>

                    </thead>

                        <tbody class="bg-white">

                            <tr formArrayName="products" *ngFor="let item of pricingForm.get('products')['controls']; let i = index;" class="whitespace-nowrap">

                                <ng-container *ngIf="pricingForm.controls.products.controls[i].controls.account_name.value  === product">
                                    <ng-container [formGroupName]="i">


                                <td class="hover:bg-gray-200 p-1">
                                    <div class="tooltip" style="max-width: 250px; white-space: pre-wrap">{{pricingForm.controls.products.controls[i].controls.product_group.value}}
<!--                                        <span class="tooltiptext">-->
<!--                                            {{pricingForm.controls.products.controls[i].controls.product_group.value}}-->

<!--                                        </span>-->
                                    </div>



                                   </td>
                                <ng-container>
                                   <td class="hover:bg-gray-200">
                                    <div>
                                        <nwn-pricing-metric-ip [base] = "item.controls.cogs.value" formControlName="inc_cogs" [currency]="currency" [is_abs]="abs">
                                            <svg (click)="applyDateTopopup(item.controls.cogs_date.value , i , 'cogs')"   width="17" height="17" viewBox="0 0 17 17" fill="red" xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M13.5423 2.91683H12.209V2.25016C12.209 2.07335 12.1387 1.90378 12.0137 1.77876C11.8887 1.65373 11.7191 1.5835 11.5423 1.5835C11.3655 1.5835 11.1959 1.65373 11.0709 1.77876C10.9459 1.90378 10.8757 2.07335 10.8757 2.25016V2.91683H6.87565V2.25016C6.87565 2.07335 6.80541 1.90378 6.68039 1.77876C6.55536 1.65373 6.3858 1.5835 6.20898 1.5835C6.03217 1.5835 5.8626 1.65373 5.73758 1.77876C5.61256 1.90378 5.54232 2.07335 5.54232 2.25016V2.91683H4.20898C3.67855 2.91683 3.16984 3.12754 2.79477 3.50262C2.4197 3.87769 2.20898 4.3864 2.20898 4.91683V12.9168C2.20898 13.4473 2.4197 13.956 2.79477 14.331C3.16984 14.7061 3.67855 14.9168 4.20898 14.9168H13.5423C14.0728 14.9168 14.5815 14.7061 14.9565 14.331C15.3316 13.956 15.5423 13.4473 15.5423 12.9168V4.91683C15.5423 4.3864 15.3316 3.87769 14.9565 3.50262C14.5815 3.12754 14.0728 2.91683 13.5423 2.91683ZM14.209 12.9168C14.209 13.0936 14.1387 13.2632 14.0137 13.3882C13.8887 13.5133 13.7191 13.5835 13.5423 13.5835H4.20898C4.03217 13.5835 3.8626 13.5133 3.73758 13.3882C3.61256 13.2632 3.54232 13.0936 3.54232 12.9168V8.25016H14.209V12.9168ZM14.209 6.91683H3.54232V4.91683C3.54232 4.74002 3.61256 4.57045 3.73758 4.44543C3.8626 4.3204 4.03217 4.25016 4.20898 4.25016H5.54232V4.91683C5.54232 5.09364 5.61256 5.26321 5.73758 5.38823C5.8626 5.51326 6.03217 5.5835 6.20898 5.5835C6.3858 5.5835 6.55536 5.51326 6.68039 5.38823C6.80541 5.26321 6.87565 5.09364 6.87565 4.91683V4.25016H10.8757V4.91683C10.8757 5.09364 10.9459 5.26321 11.0709 5.38823C11.1959 5.51326 11.3655 5.5835 11.5423 5.5835C11.7191 5.5835 11.8887 5.51326 12.0137 5.38823C12.1387 5.26321 12.209 5.09364 12.209 4.91683V4.25016H13.5423C13.7191 4.25016 13.8887 4.3204 14.0137 4.44543C14.1387 4.57045 14.209 4.74002 14.209 4.91683V6.91683Z"
                                                    [ngClass]="{'fill-def' : !pricingForm.controls.products.controls[i].controls.cogs_date.value,
                                                    'fill-blue' : pricingForm.controls.products.controls[i].controls.cogs_date.value
                                                }"
                                                />
                                            </svg>
                                            <dp-date-picker [config]="datePickerConfig" formControlName="cogs_date" style="width: 0px;" #dayPickerrsp mode="day"   placeholder=""  ></dp-date-picker>
                                            <p class="date-picker-para" *ngIf="pricingForm.controls.products.controls[i].controls.cogs_date.value" dateContent>
                                                {{pricingForm.controls.products.controls[i].controls.cogs_date.value | date: 'MMM d, y'}}
                                                <nwn-svg-icon (click) = "removeDate(i , 'cogs_date')" size="md" nwnSvgIcon="close"></nwn-svg-icon>
                                            </p>
                                            <p *ngIf="!pricingForm.controls.products.controls[i].controls.cogs_date.value" dateContent> select date</p>

                                        </nwn-pricing-metric-ip>
                                    </div>

                            </td>
                            <!--<td class="hover:bg-gray-200">
                                <div>
                                    <nwn-pricing-metric-ip (valueChangedEvent)="nsv_changed($event , i)" [currency]="currency" [is_abs]="abs" [base] = "item.controls.list_price.value" formControlName="inc_list_price">
                                        <svg (click)="applyDateTopopup(item.controls.list_price_date.value , i , 'listprice')"   width="17" height="17" viewBox="0 0 17 17" fill="red" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M13.5423 2.91683H12.209V2.25016C12.209 2.07335 12.1387 1.90378 12.0137 1.77876C11.8887 1.65373 11.7191 1.5835 11.5423 1.5835C11.3655 1.5835 11.1959 1.65373 11.0709 1.77876C10.9459 1.90378 10.8757 2.07335 10.8757 2.25016V2.91683H6.87565V2.25016C6.87565 2.07335 6.80541 1.90378 6.68039 1.77876C6.55536 1.65373 6.3858 1.5835 6.20898 1.5835C6.03217 1.5835 5.8626 1.65373 5.73758 1.77876C5.61256 1.90378 5.54232 2.07335 5.54232 2.25016V2.91683H4.20898C3.67855 2.91683 3.16984 3.12754 2.79477 3.50262C2.4197 3.87769 2.20898 4.3864 2.20898 4.91683V12.9168C2.20898 13.4473 2.4197 13.956 2.79477 14.331C3.16984 14.7061 3.67855 14.9168 4.20898 14.9168H13.5423C14.0728 14.9168 14.5815 14.7061 14.9565 14.331C15.3316 13.956 15.5423 13.4473 15.5423 12.9168V4.91683C15.5423 4.3864 15.3316 3.87769 14.9565 3.50262C14.5815 3.12754 14.0728 2.91683 13.5423 2.91683ZM14.209 12.9168C14.209 13.0936 14.1387 13.2632 14.0137 13.3882C13.8887 13.5133 13.7191 13.5835 13.5423 13.5835H4.20898C4.03217 13.5835 3.8626 13.5133 3.73758 13.3882C3.61256 13.2632 3.54232 13.0936 3.54232 12.9168V8.25016H14.209V12.9168ZM14.209 6.91683H3.54232V4.91683C3.54232 4.74002 3.61256 4.57045 3.73758 4.44543C3.8626 4.3204 4.03217 4.25016 4.20898 4.25016H5.54232V4.91683C5.54232 5.09364 5.61256 5.26321 5.73758 5.38823C5.8626 5.51326 6.03217 5.5835 6.20898 5.5835C6.3858 5.5835 6.55536 5.51326 6.68039 5.38823C6.80541 5.26321 6.87565 5.09364 6.87565 4.91683V4.25016H10.8757V4.91683C10.8757 5.09364 10.9459 5.26321 11.0709 5.38823C11.1959 5.51326 11.3655 5.5835 11.5423 5.5835C11.7191 5.5835 11.8887 5.51326 12.0137 5.38823C12.1387 5.26321 12.209 5.09364 12.209 4.91683V4.25016H13.5423C13.7191 4.25016 13.8887 4.3204 14.0137 4.44543C14.1387 4.57045 14.209 4.74002 14.209 4.91683V6.91683Z"
                                                [ngClass]="{'fill-def' : !pricingForm.controls.products.controls[i].controls.list_price_date.value,
                                                'fill-blue' : pricingForm.controls.products.controls[i].controls.list_price_date.value
                                            }"
                                            />
                                        </svg>
                                        <dp-date-picker [config]="datePickerConfig" formControlName="list_price_date" style="width: 0px;" #dayPickerrsp mode="day"   placeholder=""  ></dp-date-picker>
                                        <p class="date-picker-para" *ngIf="pricingForm.controls.products.controls[i].controls.list_price_date.value" dateContent>
                                            {{pricingForm.controls.products.controls[i].controls.list_price_date.value | date: 'MMM d, y'}}
                                            <nwn-svg-icon (click) = "removeDate(i , 'list_price_date')" size="md" nwnSvgIcon="close"></nwn-svg-icon>
                                        </p>
                                        <p *ngIf="!pricingForm.controls.products.controls[i].controls.list_price_date.value" dateContent> select date</p>

                                    </nwn-pricing-metric-ip>
                                </div>

                            </td>-->
                        </ng-container>
                             <!--   <ng-container *ngIf="!is_admin">
                                    <td class="hover:bg-gray-200">
                                        <div class="px-3 py-2 space-y-1" >
                                            <div class="flex flex-row items-center space-x-1">
                                                <p class="text-body text-dark-blue">
                                                    <span class="inline-flex items-center justify-center space-x-1"> {{currency}}{{item.controls.cogs.value}}</span>
                                                </p>
                                            </div>
                                         </div>
                                    </td>
                                   &lt;!&ndash; <td class="hover:bg-gray-200">
                                <div class="px-3 py-2 space-y-1" >

                                    <div class="flex flex-row items-center space-x-1">
                                        <p class="text-body  text-dark-blue">
                                            <span class="inline-flex items-center justify-center space-x-1  text-dark-blue">{{currency}}{{item.controls.list_price.value}}</span>
                                        </p>
                                    </div>

                            </div>

                                </td>&ndash;&gt;
                                </ng-container>-->
                                <td class="hover:bg-gray-200">
                                    <div>
                                        <nwn-pricing-metric-ip  [currency]="currency" [is_abs]="abs" [base] = "item.controls.rsp.value"

                                        formControlName="inc_rsp">
                                            <svg (click)="applyDateTopopup(item.controls.rsp_date.value , i , 'retail')"   width="17" height="17" viewBox="0 0 17 17" fill="red" xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M13.5423 2.91683H12.209V2.25016C12.209 2.07335 12.1387 1.90378 12.0137 1.77876C11.8887 1.65373 11.7191 1.5835 11.5423 1.5835C11.3655 1.5835 11.1959 1.65373 11.0709 1.77876C10.9459 1.90378 10.8757 2.07335 10.8757 2.25016V2.91683H6.87565V2.25016C6.87565 2.07335 6.80541 1.90378 6.68039 1.77876C6.55536 1.65373 6.3858 1.5835 6.20898 1.5835C6.03217 1.5835 5.8626 1.65373 5.73758 1.77876C5.61256 1.90378 5.54232 2.07335 5.54232 2.25016V2.91683H4.20898C3.67855 2.91683 3.16984 3.12754 2.79477 3.50262C2.4197 3.87769 2.20898 4.3864 2.20898 4.91683V12.9168C2.20898 13.4473 2.4197 13.956 2.79477 14.331C3.16984 14.7061 3.67855 14.9168 4.20898 14.9168H13.5423C14.0728 14.9168 14.5815 14.7061 14.9565 14.331C15.3316 13.956 15.5423 13.4473 15.5423 12.9168V4.91683C15.5423 4.3864 15.3316 3.87769 14.9565 3.50262C14.5815 3.12754 14.0728 2.91683 13.5423 2.91683ZM14.209 12.9168C14.209 13.0936 14.1387 13.2632 14.0137 13.3882C13.8887 13.5133 13.7191 13.5835 13.5423 13.5835H4.20898C4.03217 13.5835 3.8626 13.5133 3.73758 13.3882C3.61256 13.2632 3.54232 13.0936 3.54232 12.9168V8.25016H14.209V12.9168ZM14.209 6.91683H3.54232V4.91683C3.54232 4.74002 3.61256 4.57045 3.73758 4.44543C3.8626 4.3204 4.03217 4.25016 4.20898 4.25016H5.54232V4.91683C5.54232 5.09364 5.61256 5.26321 5.73758 5.38823C5.8626 5.51326 6.03217 5.5835 6.20898 5.5835C6.3858 5.5835 6.55536 5.51326 6.68039 5.38823C6.80541 5.26321 6.87565 5.09364 6.87565 4.91683V4.25016H10.8757V4.91683C10.8757 5.09364 10.9459 5.26321 11.0709 5.38823C11.1959 5.51326 11.3655 5.5835 11.5423 5.5835C11.7191 5.5835 11.8887 5.51326 12.0137 5.38823C12.1387 5.26321 12.209 5.09364 12.209 4.91683V4.25016H13.5423C13.7191 4.25016 13.8887 4.3204 14.0137 4.44543C14.1387 4.57045 14.209 4.74002 14.209 4.91683V6.91683Z"
                                                    [ngClass]="{'fill-def' : !pricingForm.controls.products.controls[i].controls.rsp_date.value,
                                                    'fill-blue' : pricingForm.controls.products.controls[i].controls.rsp_date.value
                                                }"
                                                />
                                            </svg>
                                            <dp-date-picker [config]="datePickerConfig" formControlName="rsp_date" style="width: 0px;" #dayPickerrsp mode="day"   placeholder=""  ></dp-date-picker>
                                            <p class="date-picker-para" *ngIf="pricingForm.controls.products.controls[i].controls.rsp_date.value" dateContent>
                                                {{pricingForm.controls.products.controls[i].controls.rsp_date.value | date: 'MMM d, y'}}
                                                <nwn-svg-icon (click) = "removeDate(i , 'rsp_date')" size="md" nwnSvgIcon="close"></nwn-svg-icon>
                                            </p>
                                            <p *ngIf="!pricingForm.controls.products.controls[i].controls.rsp_date.value" dateContent> select date</p>

                                        </nwn-pricing-metric-ip>
                                    </div>

                                </td>
<!--                        <td class="hover:bg-gray-200">-->
<!--                        <nwn-pricing-ip (valueChangedEvent)="nsv_changed($event , i)" [disable]="item.controls.disable_per_unit_in_promo.value" formControlName="per_unit_in_promo"></nwn-pricing-ip>-->
<!--                        </td>-->

<!--                            <td [ngClass]="{'bg-gray-200' : item.controls.disable_promo.value}" class="hover:bg-gray-200">-->

<!--                                <div>-->
<!--                                    <nwn-pricing-metric-ip [currency]="currency" [is_abs]="abs" (valueChangedEvent)="nsv_changed($event , i)"  [disable] = "item.controls.disable_promo.value" [base] = "item.controls.nsv_per_kg.value" formControlName="inc_nsv_per_kg">-->

<!--                                        <svg (click)="applyDateTopopup(item.controls.nsv_date.value , i , 'nsv' , item.controls.disable_promo.value)"  width="17" height="17" viewBox="0 0 17 17" fill="red" xmlns="http://www.w3.org/2000/svg">-->
<!--                                            <path-->
<!--                                                d="M13.5423 2.91683H12.209V2.25016C12.209 2.07335 12.1387 1.90378 12.0137 1.77876C11.8887 1.65373 11.7191 1.5835 11.5423 1.5835C11.3655 1.5835 11.1959 1.65373 11.0709 1.77876C10.9459 1.90378 10.8757 2.07335 10.8757 2.25016V2.91683H6.87565V2.25016C6.87565 2.07335 6.80541 1.90378 6.68039 1.77876C6.55536 1.65373 6.3858 1.5835 6.20898 1.5835C6.03217 1.5835 5.8626 1.65373 5.73758 1.77876C5.61256 1.90378 5.54232 2.07335 5.54232 2.25016V2.91683H4.20898C3.67855 2.91683 3.16984 3.12754 2.79477 3.50262C2.4197 3.87769 2.20898 4.3864 2.20898 4.91683V12.9168C2.20898 13.4473 2.4197 13.956 2.79477 14.331C3.16984 14.7061 3.67855 14.9168 4.20898 14.9168H13.5423C14.0728 14.9168 14.5815 14.7061 14.9565 14.331C15.3316 13.956 15.5423 13.4473 15.5423 12.9168V4.91683C15.5423 4.3864 15.3316 3.87769 14.9565 3.50262C14.5815 3.12754 14.0728 2.91683 13.5423 2.91683ZM14.209 12.9168C14.209 13.0936 14.1387 13.2632 14.0137 13.3882C13.8887 13.5133 13.7191 13.5835 13.5423 13.5835H4.20898C4.03217 13.5835 3.8626 13.5133 3.73758 13.3882C3.61256 13.2632 3.54232 13.0936 3.54232 12.9168V8.25016H14.209V12.9168ZM14.209 6.91683H3.54232V4.91683C3.54232 4.74002 3.61256 4.57045 3.73758 4.44543C3.8626 4.3204 4.03217 4.25016 4.20898 4.25016H5.54232V4.91683C5.54232 5.09364 5.61256 5.26321 5.73758 5.38823C5.8626 5.51326 6.03217 5.5835 6.20898 5.5835C6.3858 5.5835 6.55536 5.51326 6.68039 5.38823C6.80541 5.26321 6.87565 5.09364 6.87565 4.91683V4.25016H10.8757V4.91683C10.8757 5.09364 10.9459 5.26321 11.0709 5.38823C11.1959 5.51326 11.3655 5.5835 11.5423 5.5835C11.7191 5.5835 11.8887 5.51326 12.0137 5.38823C12.1387 5.26321 12.209 5.09364 12.209 4.91683V4.25016H13.5423C13.7191 4.25016 13.8887 4.3204 14.0137 4.44543C14.1387 4.57045 14.209 4.74002 14.209 4.91683V6.91683Z"-->
<!--                                                [ngClass]="{'fill-def' : !item.controls.nsv_date.value,-->
<!--                                                'fill-blue' : item.controls.nsv_date.value-->
<!--                                            }"-->
<!--                                            />-->
<!--                                        </svg>-->
<!--                                        <dp-date-picker [config]="datePickerConfig" formControlName="nsv_date" style="width: 0px;" #dayPickerpromo mode="day"   placeholder=""  ></dp-date-picker>-->
<!--                                        <p class="date-picker-para" *ngIf="pricingForm.controls.products.controls[i].controls.nsv_date.value" dateContent>-->
<!--                                            {{pricingForm.controls.products.controls[i].controls.nsv_date.value | date: 'MMM d, y'}}-->
<!--                                            <nwn-svg-icon (click) = "removeDate(i , 'nsv_date')" size="md" nwnSvgIcon="close"></nwn-svg-icon>-->
<!--                                        </p>-->
<!--                                        <p *ngIf="!pricingForm.controls.products.controls[i].controls.nsv_date.value" dateContent> select date</p>-->
<!--                                    </nwn-pricing-metric-ip>-->
<!--                                </div>-->

<!--                                </td>-->
                                <td  class="hover:bg-gray-200">
                                    <!--<div class="px-3 py-2 space-y-1" >
                                        <p class="text-caption  text-dark-blue">
                                            {{currency}}{{item.controls.nsv_per_kg.value}}

                                        </p>
                                        <div class="flex flex-row items-center space-x-1">
                                            <p class="text-body text-marsgray-700 textsize-md">
                                                <span class="inline-flex items-center justify-center space-x-1 text-gray-700">{{currency}}{{item.controls.changed_nsv_per_kg.value}}</span>
                                            </p>
                                        </div>-->

                                        <div>
                                            <nwn-pricing-metric-ip  [currency]="currency" [is_abs]="abs" [base] = "item.controls.nsv_per_kg.value" formControlName="inc_nsv_per_kg">
                                                <svg (click)="applyDateTopopup(item.controls.nsv_date.value , i , 'nsv_per_kg')"   width="17" height="17" viewBox="0 0 17 17" fill="red" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M13.5423 2.91683H12.209V2.25016C12.209 2.07335 12.1387 1.90378 12.0137 1.77876C11.8887 1.65373 11.7191 1.5835 11.5423 1.5835C11.3655 1.5835 11.1959 1.65373 11.0709 1.77876C10.9459 1.90378 10.8757 2.07335 10.8757 2.25016V2.91683H6.87565V2.25016C6.87565 2.07335 6.80541 1.90378 6.68039 1.77876C6.55536 1.65373 6.3858 1.5835 6.20898 1.5835C6.03217 1.5835 5.8626 1.65373 5.73758 1.77876C5.61256 1.90378 5.54232 2.07335 5.54232 2.25016V2.91683H4.20898C3.67855 2.91683 3.16984 3.12754 2.79477 3.50262C2.4197 3.87769 2.20898 4.3864 2.20898 4.91683V12.9168C2.20898 13.4473 2.4197 13.956 2.79477 14.331C3.16984 14.7061 3.67855 14.9168 4.20898 14.9168H13.5423C14.0728 14.9168 14.5815 14.7061 14.9565 14.331C15.3316 13.956 15.5423 13.4473 15.5423 12.9168V4.91683C15.5423 4.3864 15.3316 3.87769 14.9565 3.50262C14.5815 3.12754 14.0728 2.91683 13.5423 2.91683ZM14.209 12.9168C14.209 13.0936 14.1387 13.2632 14.0137 13.3882C13.8887 13.5133 13.7191 13.5835 13.5423 13.5835H4.20898C4.03217 13.5835 3.8626 13.5133 3.73758 13.3882C3.61256 13.2632 3.54232 13.0936 3.54232 12.9168V8.25016H14.209V12.9168ZM14.209 6.91683H3.54232V4.91683C3.54232 4.74002 3.61256 4.57045 3.73758 4.44543C3.8626 4.3204 4.03217 4.25016 4.20898 4.25016H5.54232V4.91683C5.54232 5.09364 5.61256 5.26321 5.73758 5.38823C5.8626 5.51326 6.03217 5.5835 6.20898 5.5835C6.3858 5.5835 6.55536 5.51326 6.68039 5.38823C6.80541 5.26321 6.87565 5.09364 6.87565 4.91683V4.25016H10.8757V4.91683C10.8757 5.09364 10.9459 5.26321 11.0709 5.38823C11.1959 5.51326 11.3655 5.5835 11.5423 5.5835C11.7191 5.5835 11.8887 5.51326 12.0137 5.38823C12.1387 5.26321 12.209 5.09364 12.209 4.91683V4.25016H13.5423C13.7191 4.25016 13.8887 4.3204 14.0137 4.44543C14.1387 4.57045 14.209 4.74002 14.209 4.91683V6.91683Z"
                                                        [ngClass]="{'fill-def' : !pricingForm.controls.products.controls[i].controls.nsv_date.value,
                                                    'fill-blue' : pricingForm.controls.products.controls[i].controls.nsv_date.value
                                                }"
                                                    />
                                                </svg>
                                                <dp-date-picker [config]="datePickerConfig" formControlName="nsv_date" style="width: 0px;" #dayPickerrsp mode="day"   placeholder=""  ></dp-date-picker>
                                                <p class="date-picker-para" *ngIf="pricingForm.controls.products.controls[i].controls.nsv_date.value" dateContent>
                                                    {{pricingForm.controls.products.controls[i].controls.nsv_date.value | date: 'MMM d, y'}}
                                                    <nwn-svg-icon (click) = "removeDate(i , 'nsv_date')" size="md" nwnSvgIcon="close"></nwn-svg-icon>
                                                </p>
                                                <p *ngIf="!pricingForm.controls.products.controls[i].controls.nsv_date.value" dateContent> select date</p>

                                            </nwn-pricing-metric-ip>
                                        </div>
<!--                                </div>-->
                                </td>
                                        <td class="hover:bg-gray-200">
                                            <div class="px-3 py-2 space-y-1" >
                                                <!-- <p class="text-caption text-marsyellow-800">{{item.controls.elasticity.value}}{{currency}}</p> -->
                                                <div class="flex flex-row items-center space-x-1">
                                                    <p class="text-body  text-dark-blue ">
                                                        <span class="inline-flex items-center justify-center space-x-1  text-dark-blue" *ngIf="!item.controls.external_competition.value && !item.controls.internal_competition.value">{{item.controls.base_elasticity.value}}</span>
                                                        <span class="inline-flex items-center justify-center space-x-1  text-dark-blue" *ngIf="item.controls.external_competition.value && !item.controls.internal_competition.value">{{item.controls.external_elasticity.value}}</span>
                                                        <span class="inline-flex items-center justify-center space-x-1  text-dark-blue" *ngIf="item.controls.internal_competition.value && !item.controls.external_competition.value">{{item.controls.internal_elasticity.value}}</span>
                                                        <span class="inline-flex items-center justify-center space-x-1  text-dark-blue" *ngIf="item.controls.external_competition.value && item.controls.internal_competition.value">{{item.controls.net_elasticity.value}}</span>
<!--                                                        net_internal_elasticity-->
                                                    </p>
                                                </div>
                                            </div>
                                        </td>

                                <td style="text-align:center; height: 100px">
                                    <table class="h-full w-full">
                                        <tr>
                                            <td>Internal</td>
                                            <td>External</td>
                                        </tr>
                                        <tr (click)="$event.stopPropagation()">
                                            <td><nwn-toggle-switch formControlName="internal" (valueChange)="valueChangeElasity($event,i, 'internal')" [disable]="item.controls.disable_internal.value" [checked]="item.controls.internal_competition.value" ></nwn-toggle-switch></td>
                                            <td style="text-align:center"><nwn-toggle-switch (valueChange)="valueChangeElasity($event,i, 'external')" [disable]="item.controls.disable_private.value" formControlName="private" [checked]="item.controls.external_competition.value"></nwn-toggle-switch></td>
                                        </tr>
                                    </table>
                                </td>
<!--                                 <td style="text-align:center"><nwn-toggle-switch [disable]="item.controls.disable_private.value" formControlName="private"></nwn-toggle-switch></td>-->
<!--                                <td style="text-align:center"><nwn-toggle-switch [disable]="item.controls.disable_others.value" formControlName="others"></nwn-toggle-switch></td> -->
                                </ng-container>
                                </ng-container>
                            </tr>
                        </tbody>


                    </table>

            </mat-expansion-panel>
        </form>
          </mat-accordion>

    </div>

    <div *ngIf="isExpand" class="flex flex-row w-full justify-end space-x-2 bg-marsgray-100 py-2" >

        <div class="flex flex-row items-center">
            <div class="bg-marsgray-500 w-5 h-5 mr-2 test"></div>
            <p class="text-body text-marsgray-500" (click) = "addRet()">Input Metric</p>
        </div>
        <div class="flex flex-row items-center">
            <div class="baseline-color w-5 h-5 mr-2"></div>
            <p class="text-body text-marsgray-500">Baseline Metric</p>
        </div>
    </div>
</ng-container>

    <div class="flex flex-row w-full justify-between space-x-2 bg-marsgray-100 py-2" >
        <div class="flex flex-row space-x-2 items-center">
            <div class="flex flex-row space-x-2 border-r border-marsgray-300 pr-2">
                <nwn-button [disabled] = "disable_button" (click)="downloadWeekly()" type="icon" size="iconsm" [showTooltip]="true">
                    <nwn-svg-icon type="stroke" nwnSvgIcon="download"> </nwn-svg-icon>
                    <p tooltipContent>Download Pricing Input</p>
                </nwn-button>
                <nwn-button [disabled] = "disable_button" type="icon" size="iconsm" [showTooltip]="true">
                    <nwn-svg-icon
                        type="stroke"
                        nwnSvgIcon="upload"
                        (click)="sendMessage('upload-weekly-promotions')"
                    ></nwn-svg-icon>
                    <p tooltipContent>Upload Pricing Input</p>
                </nwn-button>
            </div>
            <div class="">

            </div>
        </div>
        <div class="flex flex-row">
            <div class="flex flex-row space-x-4 items-center">
                <nwn-button type="link" size="sm" (click) = "simulatePrice('reset')"> Reset </nwn-button>
                <nwn-button [disabled] = "disable_button" type="primary" size="sm" (click) = "simulatePrice('simulate')"> Simulate </nwn-button>
                <nwn-button [disabled] = "disable_save_download" type="icon" size="iconsm" (click)="openSavePopup('save-scenario')" [showTooltip]="true">
                    <nwn-svg-icon type="stroke" nwnSvgIcon="save"></nwn-svg-icon>
                    <p tooltipContent>Save Scenario</p>
                </nwn-button>
                <nwn-button [disabled] = "disable_save_download" (click)="downloadPricing()" type="icon" size="iconsm" [showTooltip]="true">
                    <nwn-svg-icon type="stroke" nwnSvgIcon="save-download"></nwn-svg-icon>
                    <p tooltipContent>Download Scenario</p>
                </nwn-button>
                <div class="relative" (click)="isShowDivIf = !!isShowDivIf; $event.stopPropagation();">
                    <nwn-button type="icon" size="iconsm" (click)="toggleDisplayDivIf()" [showTooltip]="true">
                        <nwn-svg-icon type="stroke" nwnSvgIcon="more-horizontal"></nwn-svg-icon>
                        <p tooltipContent>More Actions</p>
                    </nwn-button>
                    <div *ngIf="!isShowDivIf">
                        <div class="absolute z-50 top-10 right-0 bg-white shadow-sm w-[186px] h-auto">
                            <div class="border-b">
                                <nwn-button
                                    type="sideBorder"
                                    size="sideBorderSize"
                                    class="w-full"
                                    (click)="sendMessage('load-scenario-pricingtool-popup'); toggleDisplayDivIf()"
                                >
                                    <nwn-svg-icon
                                        class="mr-0.5"
                                        type="stroke"
                                        nwnSvgIcon="plus"
                                        size="lg"
                                    ></nwn-svg-icon>
                                    Load Scenario
                                </nwn-button>
                            </div>
                            <div class="">
                                <nwn-button
                                    type="sideBorder"
                                    size="sideBorderSize"
                                    class="w-full"
                                    (click)="sendMessage('compare-pricing-scenario'); toggleDisplayDivIf()"
                                >
                                    <nwn-svg-icon
                                        class="mr-0.5"
                                        type="stroke"
                                        nwnSvgIcon="arrow-compare"
                                        size="lg"
                                    ></nwn-svg-icon>
                                    Compare Scenario
                                </nwn-button>
                            </div>
                        </div>
                        <div
                            *ngIf="isShowDivIf"
                            class="
                                fixed
                                top-0
                                left-0
                                right-0
                                z-[49]
                                bg-marsgray-900 bg-opacity-0
                                firefox:bg-opacity-0
                                h-full
                                w-full
                            "
                            (click)="toggleDisplayDivIf()"
                        ></div>
                        <!-- backdrop-filter backdrop-blur-xs -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="!isExpand">
    <nwn-status-bar nwnStatusBar="viewmore" (click)="expandHeader()">View More</nwn-status-bar>
</div>
<div *ngIf="isExpand">
    <nwn-status-bar nwnStatusBar="viewless" (click)="expandHeader()">View Less</nwn-status-bar>
</div>


<nwn-modal id="save-scenario" class="hidden">
    <nwn-save-scenario (saveScenarioEvent) = "saveScenario($event)"></nwn-save-scenario>
</nwn-modal>

<nwn-modal id="save-scenario-conform" class="hidden">
    <nwn-save-scenario-conform (buttonClickedEventConform)="conformSave($event)"></nwn-save-scenario-conform>
</nwn-modal>

<!-- load scenario pricingtool popup -->
<nwn-modal id="load-scenario-pricingtool-popup" class="hidden">
    <nwn-load-scenario-pricingtool-popup [currency]="currency" (load_scenario_event) = "load_scenario_event($event)"></nwn-load-scenario-pricingtool-popup>
</nwn-modal>

<nwn-modal [overflow] = "false" id="apply-all-popup" class="hidden">
    <apply-all-popup (applyCloseEvent)= "applyCloseEvent($event)" [datePickerConfig]="datePickerConfig" [metric] = "applyAllMetric" [group]="currentProductGroup" [popupExternalCheck]="popupExternalCheck" [popupInternalCheck]="popupInternalCheck"></apply-all-popup>
</nwn-modal>

<nwn-modal [overflow] = "false" id="calendar-popup" class="hidden">
    <nwn-calendar [date_form] = "date_form" (applyCloseEvent)="applyCloseEventCalendarPopup($event)" [datePickerConfig]="datePickerConfig" [applyDate]="selectedDate"></nwn-calendar >
</nwn-modal>

<nwn-modal id="upload-weekly-promotions" class="hidden">
    <nwn-upload-weekly-promotions (closeModal)="closeModal($event)" (fileUpload) = "fileUpload($event)"></nwn-upload-weekly-promotions>
</nwn-modal>


<nwn-modal id="loaded-promosimulator-scenario" class="hidden">
    <nwn-loaded-promosimulator-scenario [scenario]="'Pricing'" [currency]="currency" [promotion_viewed] = 'chosen_promotion'></nwn-loaded-promosimulator-scenario>
</nwn-modal>

















<!--


<mat-accordion *ngIf="!treemode" class="example-headers-align" multi>
    <mat-expansion-panel  *ngFor="let pan of panels"  [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
         {{pan}}
        </mat-panel-title>



      </mat-expansion-panel-header>
      <ng-container *ngFor="let ret of rets">
      <div class="flex flex-row justify-center items-end border-b">
          <div style="align-self: center;padding-right: 15px;">

            <nwn-filter-item
            type="stroke"
            nwnSvgIcon="retailers"
            [hideClose]="false"

            >
             {{ret}}
        </nwn-filter-item>
        </div>

<img style="width: 75px;height: 35px;" src="/assets/subbrand-img/orbit-otc.png" alt="" />

      </div>
      <div class="flex flex-row justify-between items-end">



      <div class="mr-3 border-r">


      </div>
      <div class="mr-3 border-r">
        <nwn-pricing-metric-input [base] = "0" [label] = "'Promo price'">
            <dp-date-picker mode="day" theme="p-30" placeholder="--/--/----" [config]="config"></dp-date-picker>
        </nwn-pricing-metric-input>


      </div>
      <div class="mr-3 border-r">
        <nwn-pricing-metric-input [base] = "0" [label] = "'Promo price'">
            <dp-date-picker mode="day" theme="p-30" placeholder="--/--/----" [config]="config"></dp-date-picker>
        </nwn-pricing-metric-input>


      </div>
      <div class="mr-3 border-r">
        <nwn-price-elasticity [base] = "0"  >

            <nwn-competition ></nwn-competition>
        </nwn-price-elasticity>

      </div>
      <div class="mr-3">
        <nwn-pricing-metric [base] = "0" [label] = "'Promo price'">
            <dp-date-picker mode="day" theme="p-30" placeholder="--/--/----" [config]="config"></dp-date-picker>
        </nwn-pricing-metric>


      </div>

    </div>
</ng-container>



    </mat-expansion-panel>

  </mat-accordion>  -->
